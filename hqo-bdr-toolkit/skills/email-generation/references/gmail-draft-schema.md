# Gmail Draft Schema — Direct MCP

## Overview

After email generation, the `/hqo:draft-emails` command first saves all emails to a JSON review file, then creates Gmail drafts directly using Cowork's built-in Gmail MCP connector. No webhooks, no API keys, no external tools.

## Flow

1. Emails generated by `/hqo:research` are collected
2. Validated and sorted by priority
3. Saved to `drafts-[company-slug]-[date].json` in the workspace folder
4. BDR reviews the file and confirms
5. Each draft is created in Gmail via `create_email_draft` MCP tool call
6. Results reported in Cowork chat

## Draft Review File Format

The JSON file saved before Gmail creation:

```json
{
  "metadata": {
    "company": "Brookfield Properties",
    "company_slug": "brookfield-properties",
    "generated_at": "2026-02-10T14:30:00Z",
    "total_drafts": 8,
    "total_skipped": 2,
    "bdr_name": "Sal",
    "bdr_email": "sal.dragone@hqo.co"
  },
  "drafts": [
    {
      "id": 1,
      "priority": "high",
      "contact": {
        "name": "Claire Outram",
        "email": "claire.outram@brookfield.com",
        "title": "SVP Asset Management",
        "persona": "Asset Manager"
      },
      "email": {
        "subject": "Brookfield's tenant retention gap",
        "body": "Hi Claire,\n\nBody text...\n\nBest,\nSal"
      }
    }
  ],
  "skip_list": [
    {
      "name": "Alex Liscio",
      "title": "Director of Operations",
      "reason": "ATTEMPTED_TO_CONTACT — no actual engagement found in HubSpot"
    }
  ]
}
```

## Per-Draft Gmail MCP Call

Each draft maps to a single `create_email_draft` tool call:

| Field | Maps To | Example |
|-------|---------|---------|
| Contact email | `recipient_email` | `claire.outram@brookfield.com` |
| Subject line | `subject` | `Brookfield's tenant retention gap` |
| Email body + signature | `body` | Assembled HTML (see below) |
| HTML flag | `is_html` | `true` (when signature present) |
| BDR email | Sender (auto from Gmail connector) | `sal.dragone@hqo.co` |

### Body Assembly (Signature Append)

The `body` sent to `create_email_draft` is assembled at draft creation time (not during email generation):

1. Take the plain-text email body (with `\n` line breaks)
2. Convert line breaks to `<br>` for HTML rendering
3. Read `bdr.signature_html` from `config/settings.json`
4. If `signature_html` is non-empty:
   - Append `<br><br>` as a spacer after the sign-off
   - Append the raw `signature_html` value
   - Set `is_html: true` on the `create_email_draft` call
5. If `signature_html` is empty (BDR hasn't provided one yet):
   - Send as plain text (`is_html: false`) with no signature block

Example assembled body:
```html
Hi Claire,<br><br>Body text here...<br><br>Best,<br>Sal<br><br><table cellpadding="0" cellspacing="0" style="font-family: Arial, sans-serif;">...</table>
```

## Priority Order

Drafts are created in priority order:

| Tier | Priority | Personas |
|------|----------|----------|
| 1 | high | Executives, Asset Managers, MDs |
| 2 | medium | Regional Directors, Property Managers |
| 3 | low | IT, Marketing, Experience, Influencers |

## Body Rules

- Email body is generated as plain text with `\n` line breaks
- End with `Best,\n[BDR Name]` — the HTML signature is appended separately at draft creation time
- The BDR's `signature_html` from `config/settings.json` is appended after the sign-off when creating the Gmail draft
- The Gmail connector does NOT auto-append signatures — we handle this ourselves
- If no signature HTML is configured, drafts are created as plain text without a signature block

## Validation (Before Creating Drafts)

- All contact emails are valid format
- Body ends with BDR sign-off (no signature block)
- Subject line is present and non-empty
- Sorted by priority (high → medium → low)

## Error Handling

- Single draft fails → Log error, continue with remaining, report failures at end
- Gmail connector not enabled → Prompt BDR to enable in Cowork settings
- No emails generated → Prompt BDR to run `/hqo:research [company]` first
